<link rel="stylesheet" href="/modules/pages/leads/campaignLeads.tmpl.css">
<link rel="stylesheet" href="modules/common/loadingicon/loading-spinner.tmpl.css"/>
<div ng-loading="loading"></div> <!--For displaying loading icon-->

<main ng-show="!isEmpty" ng-class="{ 'menu-collapsed': $baSidebarService.isMenuCollapsed() }" ng-if="loading">

<div><nav-bar></nav-bar></div>
<div ng-show="isEmpty" style="text-align:center;"><h2>{{msg}}</h2></div>
<br/><br/><br/>
<br/><br/>

<div class="" ng-show="!views.campaigns">
  <button type="button" class="btn btn-primary" style="margin-left:23px;" ng-click="changeView('campaigns',campaign)">Back To Campaign Details Page</button>
</div>
<br/><br/>
<div class="panel" ng-if="views.campaigns">
  <div class="pageTitle">
    <h3>List Of All Campaign Details</h3>
  </div>
  <div class="panel-body" style="margin-top:10px;">
    <div >
      <table st-table="campaigns" st-safe-src="Data" class="table table-striped">
        <thead>
          <tr>
            <th ng-repeat="header in campaignHeaders">{{header.header}}</th>
          </tr>
        </thead>
        <tbody>
          <tr style="text-align:center" ng-repeat="campaign in campaigns">
            <td>{{campaign.campaign.name}}</td>
            <td>{{campaign.campaign.tentative_start_date|limitTo:10}}</td>
            <td>{{campaign.campaign.tentative_end_date|limitTo:10}}</td>
            <td>
              <button class="btn btn-danger" ng-click="changeView('viewLeads',campaign)">View Leads</button>
            </td>
            <td>
              <button class="btn btn-danger" ng-click="changeView('viewLeadForms',campaign)">Create/Edit Lead Form</button>
            </td>
            <td>
              <button class="btn btn-danger" ng-click="changeView('viewLeadForms',campaign)">Enter Leads</button>
            </td>
            <td>
              <button class="btn btn-danger" ng-click="changeView('importLeads',campaign)">Import Leads</button>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="10" class="text-center">
              <div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages=""></div>
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
<!--start: leads  -->
<div class="panel" ng-if="views.viewLeads">
  <div class="pageTitle">
    <h3>Leads Data Of Campaign {{campaignName}} </h3>
  </div>
  <div class="panel-body">
    <div>
      <table class="table table-bordered table-responsive" export-csv="csv" separator=";" ng-if="leadsData.leads.length">
        <thead>
          <tr>
            <th>Index</th>
            <th ng-repeat="header in leadsData.alias_data">{{header.alias}}</th>
          </tr>
        </thead>
        <tbody >
          <tr ng-repeat="lead in leadsData.leads">
            <td>{{$index + 1}}</td>
            <td ng-repeat="alias in leadsData.alias_data" ng-if="lead[alias.original_name] != true && lead[alias.original_name] != false">{{lead[alias.original_name]}}</td>
            <td ng-repeat="alias in leadsData.alias_data" ng-if="lead[alias.original_name] == true">Yes</td>
            <td ng-repeat="alias in leadsData.alias_data" ng-if="lead[alias.original_name] == false">No</td>
          </tr>
        </tbody>
      </table>
      <div ng-if="!leadsData.leads.length">
        <label>No Leads Found</label>
      </div>
    </div>
    <a class="btn btn-danger" title="{{campaignName}} Leads" ng-click='csv.generate()' ng-href="{{ csv.link() }}"
         download="{{campaignName}}_leads.csv" ng-if="leadsData.leads.length">
        <i class="glyphicon glyphicon-new-window"></i> &#160;Download As Excel
    </a>
  </div>
</div>
<!--end: leads  -->
<!--start: create form  -->
<div class="panel " ng-if="views.createForm">
  <div class="pageTitle">
    <h3>Create/Edit Form</h3>
  </div>
  <div class="panel-body">
    <form name="fieldForm">
      <div class="">
        Enter Name For Lead Form* :
        <input type="text" class="form-control" ng-model="formName.name" required>
      </div>
      <div ng-repeat="model in leadFormFields">
        <div class="form-group col-md-5">
          <label for="email">FieldName:</label>
          <input type="text" class="form-control" ng-model="model.key_name" required>
        </div>
        <div class="form-group col-md-5">
          <label for="pwd">Field Type:</label>
          <select class="form-control" ng-model="model.key_type" required>
            <option ng-repeat="type in leadKeyTypes" value="{{type.name}}">{{type.name}}</option>
          </select>

        </div>
        <div class="form-group col-md-2">
          <label></label>
          <button type="button" class="form-control btn btn-danger" ng-click="removeField($index)">Remove</button>
        </div>
        <div class="col-md-12" ng-if="model.key_type=='RADIO' || model.key_type=='CHECKBOX' || model.key_type=='DROPDOWN'">
          Add Options:
          <input type="text" class="form-control" ng-model="optionForm.option"><span class="glyphicon glyphicon-plus" ng-click="addKeyOption(optionForm.option,$index)"></span>
          <div class="" ng-repeat="option in model.key_options">
            <span>{{option}}</span><span class="glyphicon glyphicon-minus"></span>
          </div>
        </div>
      </div>
      <button class="btn btn-danger" ng-click="addLeadFormFields()">Add</button>
      <div class="form-group col-md-12">
        <button ng-click="saveLeadForm()" style="text-align:right" class="btn btn-danger" ng-disabled="fieldForm.$invalid">Submit</button>
      </div>
    </form>
  </div>
</div>
<!--end: create form  -->
<!--start: enter leads data -->
<div class="panel " ng-if="views.selectSuppliers">
  <div class="pageTitle">
    <h3>List Of All Suppliers Of Campaign {{campaignName}}</h3>
  </div>
  <div class="panel-body">
    <div>
      <table class="table table-bordered table-responsive">
        <thead>
          <tr>
            <th>Index</th>
            <th>Supplier Name</th>
            <th>Area</th>
            <th>Subarea</th>
            <th>Address</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="supplier in suppliers">
            <td>{{$index+1}}</td>
            <td>{{supplier.name}}</td>
            <td>{{supplier.area}}</td>
            <td>{{supplier.subarea}}</td>
            <td>{{supplier.address1}} {{supplier.address2}}</td>
            <td>
              <button class="btn btn-danger" ng-click="enterLeads(supplier)">Click Here To Enter Leads</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
<!--end: enter leads data  -->
<!--start : import leads  -->
<div class="panel" ng-show="views.importLeads">
  <div class="pageTitle">
    <h3>Import Leads for {{campaignName}} Campaign</h3>
  </div>
  <div class="panel-body">
    <label>Select Lead Sheet</label>
    <js-xls onread="read" onerror="error"></js-xls></br>
    <button class="btn btn-danger " ng-click="resetData()" >Reset</button>
  </div>
  <div class="panel-body" >
    <table class="table table-bordered table-responsive" ng-if="showImportTable">
      <thead>
        <tr>
          <th>Index</th>
          <th ng-repeat="header in aliasData">
              {{header.alias}}
          </th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="data in importLeadsData">
          <td>{{$index +1}}</td>
          <td ng-repeat="alias in aliasData">{{data[alias.alias]}}</td>
        </tr>
      </tbody>
    </table>
    <br />
    <div class="">
      <button ng-click="importLeadsThroughSheet()" class="btn btn-danger">Submit</button>
    </div>
  </div>
</div>
<!--end : import leads  -->
<!--start : view lead forms -->
<div class="panel " ng-if="views.viewLeadForms">
  <div class="pageTitle">
    <h3>{{campaignName}} Lead Form List</h3>
  </div>
  <div class="panel-body">
    <div>
      <table class="table table-bordered table-responsive">
        <thead>
          <tr>
            <th>Index</th>
            <th>Form Name</th>
            <th>Action</th>
            <th>Leads</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="item in leadForms">
            <td>{{$index+1}}</td>
            <td>{{item.leads_form_name}}</td>
            <td>
              <button class="btn btn-danger" ng-click="getLeadForm(item)">Details</button>
            </td>
            <td>
              <button class="btn btn-danger" ng-click="changeView('selectSuppliers',campaignInfo,item)">Enter Leads</button>
            </td>
          </tr>
        </tbody>
      </table>
      <button class="btn btn-danger" ng-click="getLeadForm()">Create Lead Form</button>
    </div>
  </div>
</div>
<!--end : view lead forms -->
<!--start: enter leads  -->
<div class="panel" ng-if="views.enterLeads">
  <div class="pageTitle">
    <h3>Leads</h3>
    Name of Society : {{supplierData.name}}
    Area : {{supplierData.area}}
    Subarea : {{supplierData.subarea}}
  </div>
  <form class="">
    <div class="" ng-repeat="item in leadModelData">
      <div class="" ng-if="item.key_type != 'RADIO' && item.key_type != 'CHECKBOX' && item.key_type != 'DROPDOWN'" >
        {{item.key_name}}
        <input type="{{keyTypesMap[item.key_type]}}" ng-model="item.value">
      </div>
      <div class="" ng-if="item.key_type == 'DROPDOWN'">
        {{item.key_name}}
        <select class="" ng-model="item.value" >
          <option ng-repeat="option in optionsDummy" value="option">{{option.name}}</option>
        </select>
      </div>
      <div class="" ng-if="item.key_type == 'RADIO' || item.key_type == 'CHECKBOX'">
        {{item.key_name}}
        <div class="" ng-repeat="option in optionsDummy">
            <input type="{{keyTypesMap[item.key_type]}}" ng-model="item.value" name="name1" value="{{option.name}}">{{option.name}}
        </div>

      </div>

    </div>
    <div class="">
      <button class="btn btn-danger" ng-click="saveLeads()">Submit</button>
    </div>
  </form>
</div>
<!--end: enter leads  -->
