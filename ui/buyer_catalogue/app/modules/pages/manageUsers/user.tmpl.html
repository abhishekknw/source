<!--Dashboard start  -->
<link rel="stylesheet" href="modules/pages/manageUsers/user.tmpl.css"/>
<!-- Google Fonts -->
<link href='https://fonts.googleapis.com/css?family=Passion+One' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Oxygen' rel='stylesheet' type='text/css'>

<link rel="stylesheet" href="modules/common/header/menu-bar-tmpl.css"/>
<div><nav-bar></nav-bar></div>

<div  class="container-fluid">
  <!-- <div class="row"> -->
      <div class="col-sm-4">
          <div class="nav-side-menu" style="width:20%;margin-left:-30px;">
              <div class="brand">Menu</div>
              <i class="fa fa-bars fa-2x toggle-btn"></i>
              <div class="menu-list">
                  <ul id="menu-content" class="menu-content collapse out">
                      <li ng-class="{active: isActive('/manageCampaign/create')}">
                        <a class="lipadding" ng-click="getContent(contentItem.createUser)">
                          <i class="fa fa-tasks fa-lg"></i>Create User</a>
                      </li>
                      <li ng-class="{active: isActive('/OpsDashBoard')}">
                        <a class=" lipadding" ng-click="getContent(contentItem.createGroup)">
                          <i class="fa fa-dashboard fa-lg"></i>Create Group</a>
                     </li>
                     <li ng-class="{active: isActive('/OpsDashBoard')}">
                       <a class=" lipadding" ng-click="getContent(contentItem.viewUsers)">
                         <i class="fa fa-dashboard fa-lg"></i>View Users</a>
                    </li>
                    <li ng-class="{active: isActive('/OpsDashBoard')}">
                      <a class=" lipadding" ng-click="getContent(contentItem.viewGroups)">
                        <i class="fa fa-dashboard fa-lg"></i>View Groups</a>
                   </li>
                  </ul>
              </div>
          </div>
      </div>
  <!-- </div> -->

<!--start: content  -->
<div class="col-sm-8" style="margin-left:25%;margin-top:5%;" ng-switch on="menuItem.name">
  <div class="">
  <div ng-switch-when='createUser' id="createUser" style="margin-right:20%;margin-left:30%">
    <div>
      <h3 class="createUser">Create New User</h3><hr>
      <div class="row main">
        <div class="main-login main-center">
          <form class="" name="registerForm" method="post" ng-submit= "register()" role="form">
            <div class="form-group">
              <label for="name" class="cols-sm-2 control-label">First Name</label>
              <div class="cols-sm-10">
                <div class="input-group">
                  <span class="input-group-addon"><i class="fa fa-user fa" aria-hidden="true"></i></span>
                  <input type="text" class="form-control" name="firstname" id="firstname"  placeholder="Enter First Name" ng-model="model.first_name" required/>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="name" class="cols-sm-2 control-label">Last Name</label>
              <div class="cols-sm-10">
                <div class="input-group">
                  <span class="input-group-addon"><i class="fa fa-user fa" aria-hidden="true"></i></span>
                  <input type="text" class="form-control" name="lastname" id="lastname"  placeholder="Enter Last Name" ng-model="model.last_name"/>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="username" class="cols-sm-2 control-label">Username</label>
              <div class="cols-sm-10">
                <div class="input-group">
                  <span class="input-group-addon"><i class="fa fa-users fa" aria-hidden="true"></i></span>
                  <input type="text" class="form-control" name="username" id="username"  placeholder="Enter your Username" ng-model="model.username" required/>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="email" class="cols-sm-2 control-label">Email Id</label>
              <div class="cols-sm-10">
                <div class="input-group">
                  <span class="input-group-addon"><i class="fa fa-envelope fa" aria-hidden="true"></i></span>
                  <input type="email" class="form-control" name="email" id="email"  placeholder="Enter Email"
                  ng-model="model.email" required/>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="password" class="cols-sm-2 control-label">Password</label>
              <div class="cols-sm-10">
                <div class="input-group">
                  <span class="input-group-addon"><i class="fa fa-lock fa-lg" aria-hidden="true"></i></span>
                  <input type="password" class="form-control" name="password" id="password"  placeholder="Enter your Password" ng-model= "model.password" required/>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="confirm" class="cols-sm-2 control-label">Confirm Password</label>
              <div class="cols-sm-10">
                <div class="input-group">
                  <span class="input-group-addon"><i class="fa fa-lock fa-lg" aria-hidden="true"></i></span>
                  <input type="password" class="form-control" name="confirm" id="confirm"  placeholder="Confirm your Password" ng-model="model.confirm_password" ng-change="validatePassword()"required/>
                </div>
                <span ng-if="!isValid && model.confirm_password">{{passwordError}}</span>

              </div>
            </div>

            <!--start: adding group  -->
            <div class="dropdown dropdown-scroll dropup">
              <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown">Assign Group <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1" style="width:300px;">
                  <li role="presentation">
                      <div class="input-group input-group-sm search-control">
                         <span class="input-group-addon">
                              <span class="glyphicon glyphicon-search"></span>
                          </span>
                          <input type="text" class="form-control" placeholder="Query" ng-model="query"></input>
                      </div>
                  </li>
                  <li role="presentation" ng-repeat='group in permissionGroups | filter:query'>
                    <input type="checkbox" ng-model="group.selected" ng-click="addGroups(group,$index)" style="margin-left:10px;"/>
                    <a style="display:-webkit-inline-box;">{{group.name}}</a>
                  </li>
              </ul>
            </div>
            <!--end : adding group  -->
            <div class="form-group ">
              <ul class="">
                  <li ng-repeat="group in selectedGroupList">{{group}}</li>
              </ul>
            </div>

            <div class="form-group ">
              <button type="submit" id="button" class="btn btn-primary btn-lg btn-block login-button" ng-disabled="!isValid">Create User</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div ng-switch-when='createGroup'>
    <div style="margin-left:15px;" ng-if="!isEditGroup"><h3>Create New Group</h3></div></br></br>
    <div style="margin-left:15px;" ng-if="isEditGroup"><h3>Edit Group :</h3></div></br></br>
    <div class="col-md-6 form-horizontal model-body">
      <div class="form-group">
          <label class="col-md-4 control-label" style="text-align:left">Group Name</label>
          <div class="col-md-3 controls">
            <input type="text" class="form-control groupInput" placeholder="Enter Group Name" ng-model="groupName.name"/>
          </div>
      </div>
      <div class="form-group">
        <label class="col-md-4 control-label" style="text-align:left">Add Permissions</label>
        <div class="dropdown dropdown-scroll col-md-6">
          <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown">Add Permission <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
              <li role="presentation">
                  <div class="input-group input-group-sm search-control">
                     <span class="input-group-addon">
                          <span class="glyphicon glyphicon-search"></span>
                      </span>
                      <input type="text" class="form-control" placeholder="Search Permission" ng-model="query"></input>
                  </div>
              </li>
              <li role="presentation" ng-repeat='permission in permissionsDict.slice(1,permissionsDict.length) | filter:query'>
                <input type="checkbox" ng-model="permission.selected" ng-click="addPermission(permission,$index)" style="margin-left:10px;"/>
                <a style="display:-webkit-inline-box;">{{permission.name}}</a>
              </li>
          </ul>
        </div>
      </div></br></br>
      <div class="col-md-2 form-group">
        <button ng-if="permissionList.length && groupName.name && !isEditGroup" class="btn btn-primary active" ng-click="createGroup()">Create Group</button>
        <button ng-if="permissionList.length && groupName.name && isEditGroup" class="btn btn-primary active" ng-click="updateGroupDetails()">Update</button>
      </div>
    </div>

    <div class="col-md-4 list-permission" ng-if="permissionList.length">
      <h2>Permissions :</h2>
      <ul class="dropdown-list">
          <li ng-repeat="permission in permissionList">{{permission.name}}</li>
      </ul>
    </div>
  </div>
  <!--start: users list  -->
  <div ng-switch-when='viewUsers' id="viewUsers">
    <h3 style="text-align:center">List of Users</h3>
    <div class="table-responsive">
      <table class="table table-bordered">
        <th ng-repeat="header in userInfoHeaders">
          {{header.header}}
        </th>
        <tbody>
          <tr ng-repeat="user in usersList">
            <td class="col-md-1"> {{user.first_name}} </td>
            <td class="col-md-1"> {{user.last_name}} </td>
            <td class="col-md-2"> {{user.email}} </td>
            <td class="col-md-2"> {{user.username}} </td>
            <td class="col-md-2"> <li style="text-align:left" ng-repeat="group in user.groups"><a ng-click="getContent(contentItem.editGroup,group)">{{group.name}} </a></li></td>
            <td class="col-md-1" ><a data-toggle="tooltip" title="Edit" ng-click="getContent(contentItem.editUser,user)">
              <span class="glyphicon glyphicon-edit"></span></a></td>
            <td class="col-md-1">
               <a data-toggle="tooltip" title="Delete"><span class="glyphicon glyphicon-trash" ng-click="deleteUser(user)"></span></a>
            </td>
            <td>
              <a data-target="#passwordModal" data-toggle="modal" ng-click="setPasswordDetails(user)">click here</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    </div>
  <!--end: users list  -->
  <!--start: edit user  -->
  <div ng-switch-when='editUser' id="editUser">
    <h3>Edit User Details<hr></h3>
    <div class="row">
      <label for="name" class="cols-sm-2 ">First Name :</label></br>
          <input type="text" class="form-control form-user"  ng-model="userDetails.first_name" required/>
    </div></br>
    <div class="row">
      <label for="name" class="cols-sm-2 ">Last Name :</label></br>
          <input type="text" class="form-control form-user"  ng-model="userDetails.last_name" required/>
    </div></br>
    <div class="row">
      <label for="name" class="cols-sm-2 ">Email Id :</label></br>
          <input type="text" class="form-control form-user" ng-model="userDetails.email" required/>
    </div></br>
    <div class="row">
      <label for="name" class="cols-sm-2 ">Username :</label></br>
          <input type="text" class="form-control form-user" ng-model="userDetails.username" required/>
    </div></br>
    <div class="row">
      <label for="name" class="cols-sm-2 ">Mobile :</label></br>
          <input type="number" class="form-control form-user" ng-model="userDetails.mobile" required/>
    </div></br>
    <div class="dropdown dropdown-scroll dropup">
      <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown">Assign Group <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1" style="width:300px;">
          <li role="presentation">
              <div class="input-group input-group-sm search-control">
                 <span class="input-group-addon">
                      <span class="glyphicon glyphicon-search"></span>
                  </span>
                  <input type="text" class="form-control" placeholder="Search Group" ng-model="groupQuery"></input>
              </div>
          </li>
          <li role="presentation" ng-repeat='group in permissionGroups | filter:groupQuery'>
            <input type="checkbox" ng-model="group.selected" ng-click="editUserGroups(group,$index)" style="margin-left:10px;"/>
            <a style="display:-webkit-inline-box;">{{group.name}}</a>
          </li>
      </ul>
    </div>
    <div class="form-group ">
      <ul class="">
          <li ng-repeat="group in userDetails.groups">{{group.name}}</li>
      </ul>
    </div>
    <div class="form-group">
      <button type="submit" id="button" class="btn btn-primary active" ng-click="updateUserDetails(userDetails)">Update</button>
    </div>
  </div>
  <!--end: edit user  -->
  <!--start: users list  -->
  <div ng-switch-when='viewGroups' id="viewGroups">
    <div class="">
      <h3 class="col-md-7" style="text-align:center">List of Groups</h3></br>
      <table class="table-responsive table-bordered table" style="width:60%">
        <th ng-repeat="header in groupHeaders">
          {{header.header}}
        </th>
        <tbody>
          <tr ng-repeat="group in permissionGroups">
            <td class="col-md-2"> {{group.name}} </td>
            <td class="col-md-1" ><a data-toggle="tooltip" title="Edit" ng-click="getContent(contentItem.editGroup,group)">
              <span class="glyphicon glyphicon-edit"></span></a></td>
            <td class="col-md-1">
               <a data-toggle="tooltip" title="Delete"><span class="glyphicon glyphicon-trash" ng-click="deleteGroup(group)"></span></a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    </div>
  <!--end: users list  -->
</div>
<!--End of container  -->
<!--end: content  -->
</div>
</div>
<!--start : change password  -->
<div class="modal change_password" id="passwordModal" >
    <div class="modal-header">
        <h3>Change Password <span class="extra-title muted"></span></h3>
    </div>
    <form name="passwordForm">
    <div class="modal-body form-horizontal">
        <div class="form-group">
            <label for="new_password" class="col-md-4 control-label">New Password</label>
            <div class="col-md-5 controls">
                <input type="password" name="new_password" class="form-control" ng-model="userInfo.password">
            </div>
        </div>
        <div class="form-group">
            <label for="confirm_password" class="col-md-4 control-label">Confirm Password</label>
            <div class="col-md-5 controls">
                <input type="password" name="confirm_password" class="form-control" ng-model="userInfo.confirm_password" ng-change="checkPassword(userInfo.password,userInfo.confirm_password)">
                <span ng-if="!passwordValid && passwordForm.confirm_password.$dirty">{{passwordError}}</span>
            </div>
        </div>
    </div>
  </form>
    <div class="modal-footer">
        <button href="#" class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        <button href="#" class="btn btn-primary" id="password_modal_save" ng-click="changePassword()" ng-disabled="!passwordValid">Save changes</button>
    </div>
</div>
<!--end : change password  -->
