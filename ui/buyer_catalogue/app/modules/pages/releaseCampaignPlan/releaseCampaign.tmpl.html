<link rel="stylesheet" href="modules/pages/releaseCampaignPlan/releaseCampaign.tmpl.css"/>
<link rel="stylesheet" href="modules/common/loadingicon/loading-spinner.tmpl.css"/>
<div ng-loading="loading"></div>

<main ng-show="!isEmpty" ng-class="{ 'menu-collapsed': $baSidebarService.isMenuCollapsed() }" ng-if="loading" >
<div><nav-bar></nav-bar></div>
</br></br></br>
<div ng-if="!backButton" permission="[campaign_manager]">
  <back-Button></back-Button>
</div>
<div class="" permission = "[]">
  <div class="breadcrumb" ncy-breadcrumb></div>
</div>
  <div class="pageTitle">
      <h3>Booking Plan</h3>
  </div>
    <div class = "panel-body" style="text-align:center;margin-top:-20px">
        <div class="row">
          <div class="panel panel-default">
            <div class="panel-heading">
              <Label>Campaign Id:</Label><span class = "proposal-details">{{releaseDetails.campaign.proposal_id}}</span>
              <Label class = "labels">Campaign Name:</Label><span class = "proposal-details">{{releaseDetails.campaign.name}}</span>
              <Label class = "labels">BD Owner:</Label><span class = "proposal-details">{{releaseDetails.campaign.created_by}}</span>
              <Label class = "labels">Campaign State:&nbsp;</Label><span class = "proposal-details">{{getCampaignState(releaseDetails.campaign.campaign_state)}}</span>
            </div>
          </div>
        </div>
      </div>

<!-- <div class="container"> -->
  <div class="panel-body table-style">
      <table st-table="releaseDetails.shortlisted_suppliers" st-safe-src="Data" class="table table-striped">
        <thead>
          <tr>
            <th colspan='999' style="background-color:#ffffff;">
              <input st-search="" placeholder="Search ..." class="form-control"  type="search"/>
            </th>
          </tr>
          <tr>
            <th>Sr No</th>
            <th>Supplier Name</th>
            <th>Area,(Sub Area)</th>
            <th>Address</th>
            <th>RelationShip Data</th>
            <th st-sort="flat_count" st-skip-natural="true">Flat Count</th>
            <th st-sort="tower_count" st-skip-natural="true">Tower Count</th>
            <th>Inventory Type</th>
            <th>Inventory Count</th>
            <th>Inventory Supplier Price</th>
            <th>Total Supplier Price   (Per Flat)  </th>
            <th>Negotiated Price</th>
            <th>Freebies</th>
            <th>Booking Status</th>
            <th>Phase</th>
            <th>Mode Of Payment</th>
            <th>Contacts</th>
            <th>Payment Status</th>

          </tr>
        </thead>
        <tbody ng-repeat="supplier in releaseDetails.shortlisted_suppliers">
          <tr ng-repeat="(key,filter) in getFilters(supplier)">
            <td rowspan="{{key.length}}" ng-show="$first">{{$parent.$index + 1}}</td>
            <td class="" rowspan="{{key.length}}" ng-show="$first">{{supplier.name}}({{supplier.quality_rating}})</td>
            <td class="" rowspan="{{key.length}}" ng-show="$first">
            <a href="https://www.google.com/maps/?q=+{{supplier.latitude}}+{{supplier.longitude}}" target="_blank" style="text-decoration: underline; cursor: pointer;color:blue;">{{supplier.area}}, ({{supplier.subarea}}) {{supplier.address2}}</a></td>
            <td class="" rowspan="{{key.length}}" ng-show="$first" width="200">{{supplier.address1}}</td>
            <!-- <td class="" rowspan="{{key.length}}" ng-show="$first" width="200">Inventory Owner :<b> Machadalo</b>, Feedback:{{supplier.feedback}}</td> -->
            <td class="" rowspan="{{key.length}}" ng-show="$first" width="200">
              <button type="button" name="button" style="background-color:#d9534f;" ng-click="getRelationShipData(supplier)" data-target="#relationshipModal" data-toggle="modal">View Data</button>
            </td>
            <td class="" rowspan="{{key.length}}" ng-show="$first">{{supplier.flat_count}}</td>
            <td class="" rowspan="{{key.length}}" ng-show="$first">{{supplier.tower_count}}</td>

            <td class="" ng-if="key=='NA'">{{key}} </td>
            <td class="" ng-if="key!='NA'"><a class="" data-target="#invTypeModal" data-toggle="modal" ng-click="setInventoryIds(filter)" permission = "[permissions.viewInventoryIds]"><b>{{key}}</b></a>
            <span ng-if="key=='STALL'" ng-dropdown-multiselect="" options="stallLoc"  extra-settings="selected_baseline"
            selected-model="selectAllLocation"   translation-texts="selected_customTexts"></span>
            </td>

            <td class="" ng-if="key=='FLIER'">{{supplier.flat_count}}</td>
            <td class="" ng-if="key!='FLIER'">{{filter.total_count}}</td>
            <td class="">{{getInventoryPrice(filter.actual_supplier_price,key)| currency : "₹"}}</td>
            <td class="" rowspan="{{key.length}}" ng-show="$first">{{getTotalSupplierPrice(supplier)| currency : "₹"}} ({{getTotalSupplierPrice(supplier)/supplier.flat_count|limitTo:8| currency : "₹"}})</td>
            <td class="col-md-2" rowspan="{{key.length}}" ng-show="$first" ng-form name="priceform">
              <span class="error" ng-show="priceform.price.$error.min">{{positiveNoError}}</span>
              <input type="number" name="price" ng-model="supplier.total_negotiated_price" class="form-control spacing input-width" min="0" permission = "[permissions.addNegotiatedPrice,permissions.viewNegotiatedPrice]">
          <br>{{supplier.total_negotiated_price / supplier.flat_count|| 0 | limitTo:8}}  </td>
            <td style="text-align:left;" rowspan="{{key.length}}" ng-show="$first">
              <span ng-dropdown-multiselect="" options="multiSelect"  extra-settings="selected_baseline_settings"
              selected-model="searchSelectAllModel"   translation-texts="selected_baselines_customTexts"></span>
  </td>
            <td class="col-md-4" rowspan="{{key.length}}" ng-show="$first">
              <select  class="form-control spacing input-width" ng-selected="{{item.name == 'Undecided'}}" permission = "[permissions.changeBookingStatus,permissions.viewBookingStatus]">
                <option style="width:100%;" ng-repeat="item in booking_status" value="{{item.code}}">{{item.name}}</option>
              </select>
            </td>
            <td  class="col-md-2" rowspan="{{key.length}}" ng-show="$first" ng-form name="phaseform">
              <input type="number" name="phase" class="form-control spacing input-width-phase" ng-model="supplier.phase" min="1" ng-disabled="supplier.booking_status != 'BK'" permission = "[permissions.addPhase, permissions.viewPhase]">
              <span class="error" ng-show="phaseform.phase.$error.min">{{positiveNoError}}</span>
            </td>
            <!--mode of payment  -->
            <td class="" style="text-align:left" rowspan="{{key.length}}" ng-show="$first">
              <div class="radio">
                     <label><input type="radio" ng-model="supplier.payment_method" value="NEFT" ng-click="updateSupplierStatus('Y')" permission = "[permissions.viewPaymentMode,permissions.addPaymentMode]" ng-disabled="supplier.booking_status != 'BK'">NEFT</label>
              </div>

              <div ng-show="IsVisible" class="radio">
                NEFT Number:
                <input type="text" id="txtNEFTNumber" ng-model="supplier.payment_method" permission = "[permissions.viewPaymentMode,permissions.addPaymentMode]" ng-disabled="supplier.booking_status != 'BK'"/>
                <br /><br />
                <button type="button" class="btn btn-primary" name="button">Save</button>
                <button class="btn btn-primary" ngf-select="uploadImage($file,supplier)" permission = "[permissions.uploadImages]">Upload Image</button>
            </div>
              <div class="radio">
                     <label><input type="radio" ng-model="supplier.payment_method" value="CHEQUE" ng-click="updateSupplierStatus('N')" permission = "[permissions.viewPaymentMode,permissions.addPaymentMode]" ng-disabled="supplier.booking_status != 'BK'">Cheque</label>
              </div>
              <div class="radio" ng-if="supplier.status != 'X'">
                     <label><input type="radio" ng-model="supplier.payment_method" value="CASH" ng-click="updateSupplierStatus('N')" permission = "[permissions.viewPaymentMode,permissions.addPaymentMode]" ng-disabled="supplier.booking_status != 'BK'">Cash</label>
              </div>

              <div style="text-align:center">
                <a data-target="#paymentModal" data-toggle="modal" ng-click="setPayment(supplier)" permission = "[permissions.viewPaymentDetails]"><b>Details</b></a>
              </div>
            </td>
            <td class="" rowspan="{{key.length}}" ng-show="$first">
              <a class="" data-target="#contactModal" data-toggle="modal" ng-click="setContact(supplier)"><b>View Contact Details</b></a>
            </td>
            <!--for payment status  -->
            <td class="" style="text-align:left" rowspan="{{key.length}}" ng-show="$first">
              <select class="form-control spacing input-width" ng-selected="{{item.name == 'Not Initiated'}}" permission = "[permissions.viewPaymentDetails]">
                <option style="width:100%;" ng-repeat="item in payment_status" value="{{item.code}}" ng-click="updateSupplierStatus()"  ng-disabled="supplier.booking_status != 'BK'">{{item.name}}</option>
              </select>
              <!-- <div class="radio" permission = "[permissions.viewPaymentDetails]">
                     <label><input type="radio" ng-model="supplier.payment_status" value="PD" ng-click="updateSupplierStatus()" ng-disabled="supplier.booking_status != 'BK'">Paid</label>
              </div>
              <div class="radio" permission = "[permissions.viewPaymentDetails]">
                <label><input type="radio" ng-model="supplier.payment_status" value="PP" ng-click="updateSupplierStatus()" ng-disabled="supplier.booking_status != 'BK'">Pending</label>
              </div>
              <div class="radio" ng-if="supplier.status != 'X'" permission = "[permissions.viewPaymentDetails]">
                     <label><input type="radio" ng-model="supplier.payment_status" value="PNI" ng-click="updateSupplierStatus()" ng-disabled="supplier.booking_status != 'BK'">Not Paid</label>
              </div> -->
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="20" class="text-center">
              <div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages=""></div>
            </td>
          </tr>
        </tfoot>
      </table>
  </div>
  <div class = "panel-body">
    <span class = "col-md-4">
      <button class="btn btn-danger active notify" style="text-align:left; margin-left:10px" ng-click="updateData()" permission = "[permissions.updateData]">Update</button>
    </span>
    <span class = "col-md-4" style="text-align:center">
      <button data-target = "#addNewSocities"  class="btn btn-danger active notify" data-toggle="modal" ng-click="clearSearchData()">Add Suppliers</button>
    </span>
      <span class = "col-md-4" style="text-align:right">
        <button class="btn btn-danger active notify" style="text-align:right" ng-click="changeLocation()">Planning Release-Audit</button>
      </span>


  </div>

<br /><br />
  <!-- </div> -->
<!-- </div> -->
<!--Start: Code for contacts Modal Window -->
<div id="contactModal" class="modal fade">
  <div class="modal-dialog" style="width:700px">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Contact Details</h4>
        <hr/>
        <div class = "modal-body" style = "width: 650px; height: 300px;">
          <div class="modal-body col-md-4 table-responsive" style="width: 650px; height: 350px">
              <table  class="table table-bordered" style="width:100%">
                <thead>
                  <tr>
                    <th ng-repeat="header in contact_headings" style="text-align: center;"><b>{{header.header}}</b></th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat = "contact in contacts">
                    <td>{{contact.salutation}}</td>
                    <td>{{contact.name}}</td>
                    <td>{{contact.contact_type}}</td>
                    <td>{{contact.email}}</td>
                    <td>{{contact.std_code}}</td>
                    <td>{{contact.landline}}</td>
                    <td class="col-md-3">
                      <input type="tel"  placeholder="{{contact.mobile}}"  min="0" maxlength="10" class="form-control col-md-3" ng-model="supplier.mobile">
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!--End: Code for contacts Modal Window -->

<!--Start: Code for payment mode Modal Window -->
<div id="paymentModal" class="modal fade">
  <div class="modal-dialog" style="width:800px">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Mode of Payment Details</h4>
        <hr/>
        <div class = "modal-body" style = "height: 200px;" >
          <table class="table table-bordered">
            <thead>
              <tr>
                <th ng-repeat="header in payment_headings" class="col-md-2 alignment"><b>{{header.header}}</b></th>
              </tr>
            </thead>
            <tbody>
              <tr ng-if="editPaymentDetails">
                <td class="alignment">{{payment.name_for_payment}}</td>
                <td class="alignment">{{payment.bank_name}}</td>
                <td class="alignment">{{payment.ifsc_code}}</td>
                <td class="alignment">{{payment.account_no}}</td>
              </tr>
              <tr ng-if="!editPaymentDetails">
                <td class="alignment"><input ng-model="payment.name_for_payment"></td>
                <td class="alignment"><input ng-model="payment.bank_name"></td>
                <td class="alignment"><input ng-model="payment.ifsc_code"></td>
                <td class="alignment"><input ng-model="payment.account_no"></td>
              </tr>
              <tr>


              </tr>
            </tbody>
          </table>
          <div class="" ng-show="editPaymentDetails">
            <button class="btn btn-danger"
                ng-click="setEditPaymentDetails()">Edit
            </button>
          </div>
          <div class="" ng-show="!editPaymentDetails">
              <button class="btn btn-danger"  ng-click="savePaymentDetails()">Save</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!--End: Code for payment Modal Window -->
<!--Start: Code for inventory_type Modal Window -->
<div id="invTypeModal" class="modal fade">
  <div class="modal-dialog" style="width:300px">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Inventory Details</h4>
        <hr/>
        <div class = "modal-body" style = "width: 250px; height: 300px;">
          <div class="modal-body col-md-4 table-responsive" style="width: 250px; height: 250px">
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th class="col-md-2" style="text-align: center;"><b>Inventory Id</b></th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat = "item in inventoryIds">
                    <td>{{item.inventory_id}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!--End: Code for inventory type Modal Window -->

<!-- <div><footer-bar></footer-bar></div>

<!- Start: code for add more societies-->
<div id = "addNewSocities" class = "modal fade" style="color:#000000;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Add New Suppliers</h4>
          <hr/>
          <div class="" style="text-align:right">
            <button type="button" class="btn btn-danger" ng-click="showSummaryTab=!showSummaryTab" ng-disabled="!showSummaryTab">Search</button>
            <button type="button" class="btn btn-danger" ng-click="showSummaryTab=!showSummaryTab" ng-disabled="showSummaryTab">Summary</button>
          </div>
          <div>
            <label>Select Filters</label></br>
            <div ng-repeat="inv in filters" style="display:inline-block;">
              &nbsp;&nbsp;
              <li>  <input type="checkbox" ng-model="inv.selected">{{inv.name}}</li>
            </div>
          </div>

          <div class=""  ng-show="!showSummaryTab">
            <div class = "modal-body" style = "height: 100px;">
              <div ng-if="errorMsg">
                <font color="red">{{errorMsg}}</font>
              </div>
            </br></br>
              <div class="row form-inline">
                <!-- <span style="float:left"> -->
                <select class="form-control input-size"  ng-model="supplier_type_code.code">
                  <option value="">Select Supplier</option>
                  <option  ng-repeat="supplier in supplier_names" value="{{supplier.code}}" required>{{supplier.name}}</option>
                </select>
                    <label style="margin-left: 20px;margin-right: 20px;">Enter Text</label>
                      <input class="form-control input-size" type="text" ng-model="search.query" class="form-control spacing col-width" style="margin-left:10px">
                <button data-target = "" class="btn btn-danger active" data-toggle="modal" ng-click="searchSuppliers()">Search</button>
              </div>
          </br>
            </div>
          </br>
            <div class="modal-body col-md-4 table-responsive" style="width: 550px; height: 450px">
                <table class="table table-bordered" ng-if="search_status">
                  <thead>
                    <tr>
                      <th class="center-align">#</th>
                      <th class="center-align">Name</th>
                      <th class="center-align">City</th>
                      <th class="center-align">Area</th>
                      <th class="center-align">SubArea</th>
                      <th class = "col-md-2">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat = "supplier in supplierData">
                      <td>{{$index+1}}</td>
                      <td>{{supplier.name}}</td>
                      <td>{{supplier.city}}</td>
                      <td>{{supplier.area}}</td>
                      <td>{{supplier.subarea}}</td>
                      <td>
                        <div class="radio">
                          <button type="button" name="button" ng-click="addSuppliersToList(supplier)">Add</button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
          </div>
          <div class="modal-body" ng-show="showSummaryTab">
            <div class="col-md-4 table-responsive" style="width: 550px; height: 450px">
                <table class="table table-bordered" ng-if="search_status">
                  <thead>
                    <tr>
                      <th class="center-align">#</th>
                      <th class="center-align">Name</th>
                      <th class="center-align">City</th>
                      <th class="center-align">Area</th>
                      <th class="center-align">SubArea</th>
                      <th class = "col-md-2">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat = "supplier in supplierSummaryData">
                      <td>{{$index+1}}</td>
                      <td>{{supplier.name}}</td>
                      <td>{{supplier.city}}</td>
                      <td>{{supplier.area}}</td>
                      <td>{{supplier.subarea}}</td>
                      <td>
                        <div class="radio">
                          <button type="button" name="button" ng-click="removeSupplierToList(supplier.supplier_id)">Remove</button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="">
                <button type="button" class="btn btn-danger" ng-click="addSuppliersToCampaign()">Submit</button>
              </div>
          </div>
      </div>
    </div>
  </div>
</div>
<!-- End: code for add more societies-->
<!--Start: Code for RelationShip Data Modal Window -->
<div id="relationshipModal" class="modal fade">
  <div class="modal-dialog" style="width:600px">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Supplier Details</h4>
        <hr/>
        <div class = "modal-body">
          <div class="modal-body table-responsive">
              <table class="table table-bordered">
                <tbody>
                  <tr>
                    <th>Supply Owner / Representative</th>
                    <td>{{relationshipData.supplier_data[0].representative__name}}</td>
                  </tr>
                  <tr>
                    <th><b>Feedback About Society</b></th>
                    <td ng-if="relationshipData.supplier_data[0].feedback">{{relationshipData.supplier_data[0].feedback}}</td>
                    <td ng-if="!relationshipData.supplier_data[0].feedback">Not Given</td>
                  </tr>
                  <tr>
                    <th>Last Campaign Price With Name</th>
                    <td ng-if="relationshipData.campaign_data.last_campaign_price.total_negotiated_price">
                      ₹ {{relationshipData.campaign_data.last_campaign_price.total_negotiated_price}}
                     ({{relationshipData.campaign_data.last_campaign_price.proposal__name}})
                    </td>
                    <td ng-if="!relationshipData.campaign_data.last_campaign_price.total_negotiated_price">
                      NA
                    </td>
                    </tr>
                    <tr>
                    <th>Last Campaign Price Per Flat Price</th>
                    <td ng-if="relationshipData.campaign_data.last_campaign_price.total_negotiated_price">
                      ₹ {{relationshipData.campaign_data.last_campaign_price.total_negotiated_price / supplierFlatCount | limitTo : 8}}

                    </td>
                    </tr>
                  <tr>
                    <th>Count Of Previous Campaigns</th>
                    <td>{{relationshipData.campaign_data.past_campaigns}}</td>
                  </tr>


                </tbody>
              </table>
              <h3>Recently Held Campaigns</h3>
              <table class="table table-bordered table-responsive">
                <thead>
                  <tr>
                    <th>Index</th>
                    <th>Campaign Name</th>
                    <th>Organisation Name</th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="campaign in relationshipData.campaign_data.campaigns">
                    <td>{{$index+1}}</td>
                    <td>{{campaign.name}}</td>
                    <td>{{campaign.organisation_name}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!--End: Code for RelationShip Data Modal Window -->
</main>
